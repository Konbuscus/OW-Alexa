'use strict';

const webhook = require('../index').Webhook;

webhook.listen(3000, function() {
    console.log('Example server listening on port 3000!');
});


const app = require('../index').Jovo;
app.enableRequestLogging();
app.enableResponseLogging();

// listen for post requests
webhook.post('/webhook', function(req, res) {
    app.handleRequest(req, res, handlers);
    app.execute();
});


let handlers = {

    'LAUNCH': function() {
       // app.toIntent('OnboardingIntent');
       // app.ask('Hi', 'bla');
       //  app.ask('What\'s your name?', 'Your name?');
        app.ask('Was soll ich machen?', 'Was denn nun?');
    },
    'HelloWorld': function() {
       app.tell('Hello');
    },
    'OnboardingIntent': function() {
        app.tell('yo');
    },
    'CalorieCounterIntent': function(mealType, calorieCount, time) {
        // console.log(mealType, calorieCount, time);

        // let calorieCount = app.alexaSkill().isSlotConfirmed('calorieCount');
        let isCalorieCountConfirmed = app.alexaSkill().isSlotConfirmed('calorieCount');
        let isMealTypeConfirmed = app.alexaSkill().isSlotConfirmed('mealType');
        let isTimeConfirmed = app.alexaSkill().isSlotConfirmed('time');



        if (!calorieCount) {
            app.alexaSkill().dialogElicitSlot('calorieCount', 'Wie viel?');
        } else if (calorieCount && !isCalorieCountConfirmed) {
            app.alexaSkill().dialogConfirmSlot('calorieCount','Du hattest '+calorieCount+'?');
        } else {
            app.alexaSkill().dialogDelegate();
        }

        // if (app.alexaSkill().getDialogState() === 'STARTED' ||
        //     app.alexaSkill().getDialogState() === 'IN_PROGRESS') {
        //
        //     app.alexaSkill().dialogElicitSlot('calorieCount', 'Wie viel?');
        // } else if (app.alexaSkill().getDialogState() === 'COMPLETED') {
        //     app.tell('Alles klar!');
        // }

    },
};
